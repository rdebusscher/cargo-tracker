CREATE TABLE CARGO (
  ID bigint NOT NULL,
  calculated_at datetime DEFAULT NULL,
  ETA date DEFAULT NULL,
  unloaded_at_dest tinyint DEFAULT '0',
  MISDIRECTED tinyint DEFAULT '0',
  routing_status varchar(255) DEFAULT NULL,
  transport_status varchar(255) DEFAULT NULL,
  next_expected_handling_event_type varchar(255) DEFAULT NULL,
  next_expected_location_id bigint DEFAULT NULL,
  next_expected_voyage_id bigint DEFAULT NULL,
  current_voyage_id bigint DEFAULT NULL,
  last_event_id bigint DEFAULT NULL,
  last_known_location_id bigint DEFAULT NULL,
  spec_arrival_deadline date DEFAULT NULL,
  spec_destination_id bigint DEFAULT NULL,
  spec_origin_id bigint DEFAULT NULL,
  tracking_id varchar(255) DEFAULT NULL,
  origin_id bigint DEFAULT NULL,
  CONSTRAINT pk_cargo PRIMARY KEY (ID),
  CONSTRAINT UK_tracking_id UNIQUE (tracking_id)
);


  CREATE TABLE HANDLINGEVENT (
    ID bigint NOT NULL,
    completionTime date DEFAULT NULL,
    registration date DEFAULT NULL,
    "TYPE" varchar(255) DEFAULT NULL,
    cargo_id bigint DEFAULT NULL,
    location_id bigint DEFAULT NULL,
    voyage_id bigint DEFAULT NULL,
    CONSTRAINT pk_handlingevent PRIMARY KEY (ID)
  );

  CREATE TABLE LEG (
    ID bigint NOT NULL,
    load_time date DEFAULT NULL,
    unload_time date DEFAULT NULL,
    load_location_id bigint DEFAULT NULL,
    unload_location_id bigint DEFAULT NULL,
    voyage_id bigint DEFAULT NULL,
    cargo_id bigint DEFAULT NULL,
    CONSTRAINT pk_leg PRIMARY KEY (ID),
    CONSTRAINT FK_LEG_cargo_id FOREIGN KEY (cargo_id) REFERENCES CARGO (ID)
  );

  CREATE TABLE LOCATION (
    ID bigint NOT NULL,
    "NAME" varchar(255) DEFAULT NULL,
    UNLOCODE varchar(255) DEFAULT NULL,
    CONSTRAINT pk_location PRIMARY KEY (ID)
  );

  CREATE TABLE SEQUENCE (
    SEQ_NAME varchar(50) NOT NULL,
    SEQ_COUNT decimal(38,0) DEFAULT NULL,
    CONSTRAINT pk_sequence PRIMARY KEY (SEQ_NAME)
  );

  CREATE TABLE VOYAGE (
    ID bigint NOT NULL,
    voyage_number varchar(255) DEFAULT NULL,
    CONSTRAINT pk_voyage PRIMARY KEY (ID)
  );

  CREATE TABLE CARRIER_MOVEMENT (
    ID bigint NOT NULL,
    arrival_time datetime DEFAULT NULL,
    departure_time datetime DEFAULT NULL,
    arrival_location_id bigint DEFAULT NULL,
    departure_location_id bigint DEFAULT NULL,
    voyage_id bigint DEFAULT NULL,
    CONSTRAINT pk_carrier_movemenbt PRIMARY KEY (ID),
    CONSTRAINT FK_carrier_movement_arrival_location_id FOREIGN KEY (arrival_location_id) REFERENCES LOCATION (ID),
    CONSTRAINT FK_carrier_movement_departure_location_id FOREIGN KEY (departure_location_id) REFERENCES LOCATION (ID),
    CONSTRAINT FK_carrier_movement_voyage_id FOREIGN KEY (voyage_id) REFERENCES VOYAGE (ID)
  );


INSERT INTO SEQUENCE VALUES ('SEQ_GEN',2000);
INSERT INTO LOCATION VALUES (1901,'Hong Kong','CNHKG');
INSERT INTO LOCATION VALUES (1902,'Melbourne','AUMEL');
INSERT INTO LOCATION VALUES (1903,'Stockholm','SESTO');
INSERT INTO LOCATION VALUES (1904,'Helsinki','FIHEL');
INSERT INTO LOCATION VALUES (1905,'Chicago','USCHI');
INSERT INTO LOCATION VALUES (1906,'Tokyo','JNTKO');
INSERT INTO LOCATION VALUES (1907,'Hamburg','DEHAM');
INSERT INTO LOCATION VALUES (1908,'Shanghai','CNSHA');
INSERT INTO LOCATION VALUES (1909,'Rotterdam','NLRTM');
INSERT INTO LOCATION VALUES (1910,'Guttenburg','SEGOT');
INSERT INTO LOCATION VALUES (1911,'Hangzhou','CNHGH');
INSERT INTO LOCATION VALUES (1912,'New York','USNYC');
INSERT INTO LOCATION VALUES (1913,'Dallas','USDAL');
INSERT INTO VOYAGE VALUES (1914,'0100S');
INSERT INTO VOYAGE VALUES (1919,'0200T');
INSERT INTO VOYAGE VALUES (1922,'0300A');
INSERT INTO VOYAGE VALUES (1926,'0400S');
INSERT INTO VOYAGE VALUES (1930,'0301S');

INSERT INTO CARRIER_MOVEMENT VALUES (1915,'2013-10-03 14:30:00','2013-10-01 12:00:00',1911,1901,1914);
INSERT INTO CARRIER_MOVEMENT VALUES (1916,'2013-10-06 06:15:00','2013-10-03 21:00:00',1906,1911,1914);
INSERT INTO CARRIER_MOVEMENT VALUES (1917,'2013-10-12 11:30:00','2013-10-06 11:00:00',1902,1906,1914);
INSERT INTO CARRIER_MOVEMENT VALUES (1918,'2013-10-23 23:10:00','2013-10-14 12:00:00',1912,1902,1914);
INSERT INTO CARRIER_MOVEMENT VALUES (1920,'2013-10-24 17:45:00','2013-10-24 07:00:00',1905,1912,1919);
INSERT INTO CARRIER_MOVEMENT VALUES (1921,'2013-10-25 19:30:00','2013-10-24 21:25:00',1913,1905,1919);
INSERT INTO CARRIER_MOVEMENT VALUES (1923,'2013-10-31 14:00:00','2013-10-29 03:30:00',1907,1913,1922);
INSERT INTO CARRIER_MOVEMENT VALUES (1924,'2013-11-01 18:40:00','2013-11-01 15:20:00',1903,1907,1922);
INSERT INTO CARRIER_MOVEMENT VALUES (1925,'2013-11-02 11:15:00','2013-11-02 09:00:00',1904,1903,1922);
INSERT INTO CARRIER_MOVEMENT VALUES (1927,'2013-11-06 14:10:00','2013-11-04 05:50:00',1909,1904,1926);
INSERT INTO CARRIER_MOVEMENT VALUES (1928,'2013-11-22 16:40:00','2013-11-10 21:45:00',1908,1909,1926);
INSERT INTO CARRIER_MOVEMENT VALUES (1929,'2013-11-28 13:37:00','2013-11-24 07:00:00',1901,1908,1926);
INSERT INTO CARRIER_MOVEMENT VALUES (1931,'2013-11-05 15:45:00','2013-10-29 03:30:00',1904,1913,1930);


INSERT INTO LEG VALUES (1933,'2018-09-24','2018-09-30',1901,1912,1914,1932);
INSERT INTO LEG VALUES (1934,'2018-10-03','2018-10-07',1912,1913,1919,1932);
INSERT INTO LEG VALUES (1935,'2018-10-09','2018-10-15',1913,1904,1922,1932);
INSERT INTO LEG VALUES (1940,'2018-09-21','2018-09-28',1911,1912,1914,1939);
INSERT INTO LEG VALUES (1941,'2018-09-29','2018-10-03',1912,1913,1919,1939);
INSERT INTO LEG VALUES (1942,'2018-10-07','2018-10-16',1913,1903,1922,1939);
INSERT INTO LEG VALUES (1949,'2018-08-28','2018-09-03',1912,1913,1919,1948);

ALTER TABLE LEG
   ADD CONSTRAINT FK_LEG_load_location_id FOREIGN KEY (load_location_id) REFERENCES LOCATION (ID);
ALTER TABLE LEG
  ADD CONSTRAINT FK_LEG_unload_location_id FOREIGN KEY (unload_location_id) REFERENCES LOCATION (ID);
ALTER TABLE LEG
   ADD CONSTRAINT FK_LEG_voyage_id FOREIGN KEY (voyage_id) REFERENCES VOYAGE (ID);

INSERT INTO HANDLINGEVENT VALUES (1936,'2018-09-21','2018-10-01','RECEIVE',1932,1901,NULL);
INSERT INTO HANDLINGEVENT VALUES (1937,'2018-09-24','2018-10-01','LOAD',1932,1901,1914);
INSERT INTO HANDLINGEVENT VALUES (1938,'2018-09-30','2018-10-01','UNLOAD',1932,1912,1914);
INSERT INTO HANDLINGEVENT VALUES (1943,'2018-09-16','2018-10-01','RECEIVE',1939,1911,NULL);
INSERT INTO HANDLINGEVENT VALUES (1944,'2018-09-21','2018-10-01','LOAD',1939,1911,1914);
INSERT INTO HANDLINGEVENT VALUES (1945,'2018-09-28','2018-10-01','UNLOAD',1939,1912,1914);
INSERT INTO HANDLINGEVENT VALUES (1946,'2018-09-29','2018-10-01','LOAD',1939,1912,1914);
INSERT INTO HANDLINGEVENT VALUES (1950,'2018-08-25','2018-10-01','RECEIVE',1948,1912,NULL);
INSERT INTO HANDLINGEVENT VALUES (1951,'2018-08-28','2018-10-01','LOAD',1948,1912,1919);
INSERT INTO HANDLINGEVENT VALUES (1952,'2018-09-03','2018-10-01','UNLOAD',1948,1913,1919);
INSERT INTO HANDLINGEVENT VALUES (1953,'2018-09-04','2018-10-01','CUSTOMS',1948,1913,NULL);
INSERT INTO HANDLINGEVENT VALUES (1954,'2018-09-05','2018-10-01','CLAIM',1948,1913,NULL);

ALTER TABLE HANDLINGEVENT
   ADD CONSTRAINT FK_HANDLINGEVENT_location_id FOREIGN KEY (location_id) REFERENCES LOCATION (ID);
ALTER TABLE HANDLINGEVENT
  ADD CONSTRAINT FK_HANDLINGEVENT_voyage_id FOREIGN KEY (voyage_id) REFERENCES VOYAGE (ID);

INSERT INTO CARGO VALUES (1932,'2018-10-01 11:51:02.265','2018-10-15',0,0,'ROUTED','IN_PORT','LOAD',1912,1919,NULL,1938,1912,'2018-10-16',1904,1901,'ABC123',1901);
INSERT INTO CARGO VALUES (1939,'2018-10-01 11:51:02.308',NULL,0,1,'ROUTED','ONBOARD_CARRIER',NULL,NULL,NULL,1914,1946,1912,'2018-10-19',1903,1911,'JKL567',1911);
INSERT INTO CARGO VALUES (1947,'2018-10-01 11:51:02.309',NULL,0,0,'NOT_ROUTED','NOT_RECEIVED',NULL,NULL,NULL,NULL,NULL,NULL,'2018-12-01',1902,1901,'DEF789',1901);
INSERT INTO CARGO VALUES (1948,'2018-10-01 11:51:02.344','2018-09-03',0,0,'ROUTED','CLAIMED',NULL,NULL,NULL,NULL,1954,1913,'2018-09-07',1913,1912,'MNO456',1912);


ALTER TABLE CARGO
    ADD CONSTRAINT FK_CARGO_current_voyage_id FOREIGN KEY (current_voyage_id) REFERENCES VOYAGE (ID);
ALTER TABLE CARGO
    ADD CONSTRAINT FK_CARGO_last_event_id FOREIGN KEY (last_event_id) REFERENCES HANDLINGEVENT (ID);
ALTER TABLE CARGO
    ADD CONSTRAINT FK_CARGO_last_known_location_id FOREIGN KEY (last_known_location_id) REFERENCES LOCATION (ID);
ALTER TABLE CARGO
    ADD CONSTRAINT FK_CARGO_next_expected_location_id FOREIGN KEY (next_expected_location_id) REFERENCES LOCATION (ID);
ALTER TABLE CARGO
    ADD CONSTRAINT FK_CARGO_next_expected_voyage_id FOREIGN KEY (next_expected_voyage_id) REFERENCES VOYAGE (ID);
ALTER TABLE CARGO
    ADD CONSTRAINT FK_CARGO_origin_id FOREIGN KEY (origin_id) REFERENCES LOCATION (ID);
ALTER TABLE CARGO
    ADD CONSTRAINT FK_CARGO_spec_destination_id FOREIGN KEY (spec_destination_id) REFERENCES LOCATION (ID);
ALTER TABLE CARGO
    ADD CONSTRAINT FK_CARGO_spec_origin_id FOREIGN KEY (spec_origin_id) REFERENCES LOCATION (ID);

ALTER TABLE LEG
  ADD CONSTRAINT FK_LEG_cargo_id FOREIGN KEY (cargo_id) REFERENCES CARGO (ID);

ALTER TABLE HANDLINGEVENT
  ADD CONSTRAINT FK_HANDLINGEVENT_cargo_id FOREIGN KEY (cargo_id) REFERENCES CARGO (ID);
